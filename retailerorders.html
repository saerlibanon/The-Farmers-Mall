<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Seller Orders – The Farmer’s Mall</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<header class="bg-white border-b shadow-sm sticky top-0 z-50">
  <div class="max-w-6xl mx-auto px-6 py-3 flex items-center justify-between">

    <!-- Left: Logo -->
    <div class="flex items-center space-x-3 cursor-pointer" onclick="window.location.href='sellerdashboard.html'">
      <h1 class="text-xl font-bold text-green-700">The Farmer's Mall</h1>
    </div>

    <!-- Center: Search -->
    <div class="flex-1 mx-8 max-w-xl">
      <div class="relative">
        <i class="fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400"></i>
        <input type="text" placeholder="Search..."
          class="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-green-600 focus:border-green-600 text-sm">
      </div>
    </div>

    <!-- Right: Icons & Profile -->
    <div class="flex items-center space-x-6">
      
      <!-- Messages -->
      <a href="seller-message.html" class="relative cursor-pointer">
        <i class="fa-regular fa-comment text-xl text-gray-600"></i>
        <span class="absolute -top-2 -right-2 bg-green-700 text-white text-xs font-semibold rounded-full px-1.5">3</span>
      </a>

      <!-- Notifications -->
      <a href="seller-notifications.html" class="relative cursor-pointer">
        <i class="fa-regular fa-bell text-xl text-gray-600"></i>
        <span class="absolute -top-2 -right-2 bg-green-700 text-white text-xs font-semibold rounded-full px-1.5">5</span>
      </a>

      <!-- Profile -->
      <a href="retailerprofile.html" class="flex items-center space-x-2 cursor-pointer">
        <img src="https://randomuser.me/api/portraits/men/32.jpg" class="w-8 h-8 rounded-full" alt="Seller Profile">
        <div class="profile-info">
          <p class="text-sm font-medium text-gray-800">Mesa Farm</p>
          <p class="text-xs text-gray-500">Seller</p>
        </div>
      </a>

    </div>
  </div>
</header>

  <!-- MAIN CONTENT -->
  <main class="flex-grow">
    <div class="max-w-6xl mx-auto px-6 py-8 mb-36">
    <div class="max-w-6xl mx-auto px-6 py-8 mb-48">
      <!-- Back & Title -->
      <div class="flex items-center space-x-3 mb-6">
        <button onclick="window.location.href='retailerdashboard.html'" class="text-gray-600 hover:text-black">
          <i class="fa-solid fa-arrow-left text-lg"></i>
        </button>
        <h2 class="text-lg font-semibold">All Orders</h2>
      </div>

      <!-- Controls -->
      <div
        class="bg-white rounded-lg shadow-sm p-5 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div id="orderCount" class="text-gray-600 text-sm">Showing 0 of 0 orders</div>
        <div class="flex items-center gap-2">
          <button id="sortBtn"
            class="border px-3 py-1.5 rounded-md text-gray-700 text-sm flex items-center gap-1 hover:bg-gray-100">
            <i class="fa-solid fa-sort"></i> Sort
          </button>
          <button id="filterBtn"
            class="border px-3 py-1.5 rounded-md text-gray-700 text-sm flex items-center gap-1 hover:bg-gray-100">
            <i class="fa-solid fa-filter"></i> Filter
          </button>
          <button id="exportBtn" class="bg-green-600 text-white px-4 py-1.5 rounded-md text-sm hover:bg-green-700">
            Export
          </button>
        </div>
      </div>

      <!-- Table -->
      <div class="mt-6 bg-white rounded-lg shadow-sm overflow-hidden">
        <table class="min-w-full text-sm text-gray-700">
          <thead class="border-b bg-gray-50 text-left text-xs uppercase text-gray-500">
            <tr>
              <th class="px-6 py-3 font-medium">Customer</th>
              <th class="px-6 py-3 font-medium">Order ID</th>
              <th class="px-6 py-3 font-medium">Items</th>
              <th class="px-6 py-3 font-medium">Total</th>
              <th class="px-6 py-3 font-medium">Date</th>
              <th class="px-6 py-3 font-medium">Status</th>
              <th class="px-6 py-3 font-medium text-right">Action</th>
            </tr>
          </thead>
          <tbody id="ordersTableBody" class="divide-y"></tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div id="paginationContainer" class="flex justify-center items-center gap-2 mt-6"></div>
    </div>
  </main>

  <!-- Sort Modal -->
  <div id="sortModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-sm">
      <h3 class="font-semibold text-lg mb-4">Sort Orders By</h3>
      <div class="space-y-2">
        <label class="flex items-center"><input type="radio" name="sort" value="date-desc" class="accent-green-600 mr-2" checked> Date (Newest First)</label>
        <label class="flex items-center"><input type="radio" name="sort" value="date-asc" class="accent-green-600 mr-2"> Date (Oldest First)</label>
        <label class="flex items-center"><input type="radio" name="sort" value="total-desc" class="accent-green-600 mr-2"> Total (High to Low)</label>
        <label class="flex items-center"><input type="radio" name="sort" value="total-asc" class="accent-green-600 mr-2"> Total (Low to High)</label>
      </div>
      <div class="mt-6 flex justify-end gap-3">
        <button id="closeSortModal" class="px-4 py-2 border rounded-md text-sm">Cancel</button>
        <button id="applySort" class="px-4 py-2 bg-green-600 text-white rounded-md text-sm">Apply</button>
      </div>
    </div>
  </div>

  <!-- Filter Modal -->
  <div id="filterModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-sm">
      <h3 class="font-semibold text-lg mb-4">Filter Orders</h3>
      <div class="space-y-4">
        <div>
          <h4 class="font-medium text-sm mb-2">Status</h4>
          <div class="grid grid-cols-2 gap-2">
            <label class="flex items-center"><input type="checkbox" name="status" value="Pending" class="accent-green-600 mr-2"> Pending</label>
            <label class="flex items-center"><input type="checkbox" name="status" value="Shipped" class="accent-green-600 mr-2"> Shipped</label>
            <label class="flex items-center"><input type="checkbox" name="status" value="Delivered" class="accent-green-600 mr-2"> Delivered</label>
            <label class="flex items-center"><input type="checkbox" name="status" value="Cancelled" class="accent-green-600 mr-2"> Cancelled</label>
          </div>
        </div>
        <div>
          <h4 class="font-medium text-sm mb-2">Date Range</h4>
          <div class="flex items-center gap-2">
            <input type="date" id="startDate" class="w-full border rounded-md px-2 py-1 text-sm">
            <span>to</span>
            <input type="date" id="endDate" class="w-full border rounded-md px-2 py-1 text-sm">
          </div>
        </div>
      </div>
      <div class="mt-6 flex justify-between">
        <button id="clearFilters" class="px-4 py-2 border rounded-md text-sm text-gray-700">Clear Filters</button>
        <div class="flex gap-3">
          <button id="closeFilterModal" class="px-4 py-2 border rounded-md text-sm">Cancel</button>
          <button id="applyFilters" class="px-4 py-2 bg-green-600 text-white rounded-md text-sm">Apply</button>
        </div>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="text-white py-12 mt-12" style="background-color: #1B5E20;">
    <div class="max-w-6xl mx-auto px-6 grid md:grid-cols-4 gap-8">
      <!-- Logo/About -->
      <div>
        <h3 class="font-bold text-lg mb-3">The Farmer's Mall</h3>
        <p class="text-gray-300 text-sm">
          Fresh, organic produce delivered straight to your home from local farmers.
        </p>
      </div>

      <!-- Quick Links -->
      <div>
        <h3 class="font-bold text-lg mb-3">Quick Links</h3>
        <ul class="space-y-2 text-sm text-gray-300">
          <li><a href="#" class="hover:underline">About Us</a></li>
          <li><a href="#" class="hover:underline">Contact</a></li>
          <li><a href="#" class="hover:underline">FAQ</a></li>
          <li><a href="#" class="hover:underline">Support</a></li>
        </ul>
      </div>

      <!-- Categories -->
      <div>
        <h3 class="font-bold text-lg mb-3">Categories</h3>
        <ul class="space-y-2 text-sm text-gray-300">
          <li><a href="#" class="hover:underline">Vegetables</a></li>
          <li><a href="#" class="hover:underline">Fruits</a></li>
          <li><a href="#" class="hover:underline">Dairy</a></li>
          <li><a href="#" class="hover:underline">Meat</a></li>
        </ul>
      </div>

      <!-- Social -->
      <div>
        <h3 class="font-bold text-lg mb-3">Follow Us</h3>
        <div class="flex space-x-4 text-xl">
          <a href="#"><i class="fab fa-facebook"></i></a>
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
        </div>
      </div>
    </div>

    <!-- Divider -->
    <div class="border-t border-green-800 text-center text-gray-400 text-sm mt-10 pt-6">
      © 2025 The Farmer's Mall. All rights reserved.
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const ordersTableBody = document.getElementById('ordersTableBody');
      const allOrders = JSON.parse(localStorage.getItem('sellerOrders')) || [];
      const orderCountEl = document.getElementById('orderCount');
      const paginationContainer = document.getElementById('paginationContainer');
      const itemsPerPage = 5;
      let currentOrders = [...allOrders];

      // Modal elements
      const sortBtn = document.getElementById('sortBtn');
      const filterBtn = document.getElementById('filterBtn');
      const sortModal = document.getElementById('sortModal');
      const filterModal = document.getElementById('filterModal');
      const closeSortModal = document.getElementById('closeSortModal');
      const closeFilterModal = document.getElementById('closeFilterModal');
      const applySort = document.getElementById('applySort');
      const applyFilters = document.getElementById('applyFilters');
      const clearFilters = document.getElementById('clearFilters');

      let currentPage = 1;

      const renderOrders = () => {
        ordersTableBody.innerHTML = '';
        
        const startIndex = (currentPage - 1) * itemsPerPage;
        const paginatedOrders = currentOrders.slice(startIndex, startIndex + itemsPerPage);

        if (currentOrders.length === 0) {
          ordersTableBody.innerHTML = '<tr><td colspan="7" class="text-center py-10 text-gray-500">No orders found.</td></tr>';
          orderCountEl.textContent = 'Showing 0 of 0 orders';
          renderPagination();
          return;
        }

        paginatedOrders.forEach(order => {
          const tr = document.createElement('tr');
          tr.className = 'hover:bg-gray-50 cursor-pointer';
          tr.onclick = () => {
            // Save the selected order to localStorage and navigate
            localStorage.setItem('selectedSellerOrder', JSON.stringify(order));
            window.location.href = `retailerorderdetails.html?orderId=${order.id}`;
          };

          let statusClass = 'bg-gray-100 text-gray-700';
          if (order.status === 'Delivered') statusClass = 'bg-green-100 text-green-700';
          else if (order.status === 'Shipped') statusClass = 'bg-blue-100 text-blue-700';
          else if (order.status === 'Pending') statusClass = 'bg-orange-100 text-orange-700';
          else if (order.status === 'Cancelled') statusClass = 'bg-red-100 text-red-700';

          tr.innerHTML = `
            <td class="px-6 py-4 flex items-center space-x-3">
              <img src="https://randomuser.me/api/portraits/men/${Math.floor(Math.random() * 10)}.jpg" class="w-8 h-8 rounded-full" alt="">
              <div>
                <p class="font-medium">${order.customerName}</p>
                <p class="text-gray-500 text-xs">${order.id}</p>
              </div>
            </td>
            <td class="px-6 py-4">${order.id}</td>
            <td class="px-6 py-4">N/A</td>
            <td class="px-6 py-4 font-medium">₱${order.total.toFixed(2)}</td>
            <td class="px-6 py-4">${new Date(order.timestamp).toLocaleDateString()}</td>
            <td class="px-6 py-4">
              <span class="${statusClass} px-2 py-1 text-xs font-medium rounded-full">${order.status}</span>
            </td>
            <td class="px-6 py-4 text-right text-green-600">
              <i class="fa-solid fa-chevron-right"></i>
            </td>
          `;
          ordersTableBody.appendChild(tr);
        });

        orderCountEl.textContent = `Showing ${paginatedOrders.length} of ${currentOrders.length} orders`;
        renderPagination();
      };

      const renderPagination = () => {
        paginationContainer.innerHTML = '';
        const totalPages = Math.ceil(currentOrders.length / itemsPerPage);
        if (totalPages <= 1) return;

        // Prev button
        const prevBtn = document.createElement('button');
        prevBtn.innerHTML = '<i class="fa-solid fa-chevron-left"></i>';
        prevBtn.className = 'border w-8 h-8 rounded-md text-gray-600 hover:bg-gray-100 text-sm disabled:opacity-50 disabled:cursor-not-allowed';
        prevBtn.disabled = currentPage === 1;
        prevBtn.onclick = () => { currentPage--; renderOrders(); };
        paginationContainer.appendChild(prevBtn);

        // Page number buttons
        for (let i = 1; i <= totalPages; i++) {
          const pageBtn = document.createElement('button');
          pageBtn.textContent = i;
          pageBtn.className = `border w-8 h-8 rounded-md text-sm ${i === currentPage ? 'bg-green-600 text-white' : 'text-gray-600 hover:bg-gray-100'}`;
          pageBtn.onclick = () => { currentPage = i; renderOrders(); };
          paginationContainer.appendChild(pageBtn);
        }

        // Next button
        const nextBtn = document.createElement('button');
        nextBtn.innerHTML = '<i class="fa-solid fa-chevron-right"></i>';
        nextBtn.className = 'border w-8 h-8 rounded-md text-gray-600 hover:bg-gray-100 text-sm disabled:opacity-50 disabled:cursor-not-allowed';
        nextBtn.disabled = currentPage === totalPages;
        nextBtn.onclick = () => { currentPage++; renderOrders(); };
        paginationContainer.appendChild(nextBtn);
      };

      // Sorting logic
      const sortOrders = (sortValue) => {
        switch (sortValue) {
          case 'date-desc':
            currentOrders.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            break;
          case 'date-asc':
            currentOrders.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            break;
          case 'total-desc':
            currentOrders.sort((a, b) => b.total - a.total);
            break;
          case 'total-asc':
            currentOrders.sort((a, b) => a.total - b.total);
            break;
        }
        currentPage = 1;
        renderOrders();
      };

      // Filtering logic
      const filterOrders = () => {
        const selectedStatuses = Array.from(document.querySelectorAll('input[name="status"]:checked')).map(cb => cb.value);
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;

        let filtered = [...allOrders];

        if (selectedStatuses.length > 0) {
          filtered = filtered.filter(order => selectedStatuses.includes(order.status));
        }

        if (startDate) {
          filtered = filtered.filter(order => new Date(order.timestamp) >= new Date(startDate));
        }

        if (endDate) {
          // Add 1 day to endDate to include the whole day
          const end = new Date(endDate);
          end.setDate(end.getDate() + 1);
          filtered = filtered.filter(order => new Date(order.timestamp) < end);
        }

        currentOrders = filtered;
        currentPage = 1;
        renderOrders();
      };

      // Modal toggles
      sortBtn.addEventListener('click', () => sortModal.classList.remove('hidden'));
      closeSortModal.addEventListener('click', () => sortModal.classList.add('hidden'));
      filterBtn.addEventListener('click', () => filterModal.classList.remove('hidden'));
      closeFilterModal.addEventListener('click', () => filterModal.classList.add('hidden'));

      // Apply buttons
      applySort.addEventListener('click', () => {
        const sortValue = document.querySelector('input[name="sort"]:checked').value;
        sortOrders(sortValue);
        sortModal.classList.add('hidden');
      });

      applyFilters.addEventListener('click', () => {
        filterOrders();
        filterModal.classList.add('hidden');
      });

      // Clear filters
      clearFilters.addEventListener('click', () => {
        document.querySelectorAll('input[name="status"]').forEach(cb => cb.checked = false);
        document.getElementById('startDate').value = '';
        document.getElementById('endDate').value = '';
        currentOrders = [...allOrders];
        renderOrders();
        filterModal.classList.add('hidden');
      });

      // Close modals on outside click
      window.addEventListener('click', (e) => {
        if (e.target === sortModal) sortModal.classList.add('hidden');
        if (e.target === filterModal) filterModal.classList.add('hidden');
      });

      // Initial render
      renderOrders();
    });
  </script>
</body>
</html>
